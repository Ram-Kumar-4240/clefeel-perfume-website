<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shop - Clefeel Perfumes | Browse Our Collection</title>
  <meta name="description" content="Browse our exclusive collection of premium perfumes. Filter by gender, price range, and find your perfect scent.">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <script src="/js/main.js"></script>
  
  <main class="shop-page">
    <div class="container">
      <div class="shop-layout">
        <!-- Sidebar Filters -->
        <aside class="sidebar">
          <div class="filter-section">
            <h3 class="filter-title">Gender</h3>
            <div class="filter-options">
              <label class="filter-option">
                <input type="radio" name="gender" value="" checked onchange="applyFilters()">
                <span>All</span>
              </label>
              <label class="filter-option">
                <input type="radio" name="gender" value="men" onchange="applyFilters()">
                <span>Men</span>
              </label>
              <label class="filter-option">
                <input type="radio" name="gender" value="women" onchange="applyFilters()">
                <span>Women</span>
              </label>
              <label class="filter-option">
                <input type="radio" name="gender" value="unisex" onchange="applyFilters()">
                <span>Unisex</span>
              </label>
            </div>
          </div>
          
          <div class="filter-section">
            <h3 class="filter-title">Price Range</h3>
            <div class="filter-options">
              <label class="filter-option">
                <input type="radio" name="price" value="" checked onchange="applyFilters()">
                <span>All Prices</span>
              </label>
              <label class="filter-option">
                <input type="radio" name="price" value="0-2000" onchange="applyFilters()">
                <span>Under ‚Çπ2,000</span>
              </label>
              <label class="filter-option">
                <input type="radio" name="price" value="2000-5000" onchange="applyFilters()">
                <span>‚Çπ2,000 - ‚Çπ5,000</span>
              </label>
              <label class="filter-option">
                <input type="radio" name="price" value="5000-10000" onchange="applyFilters()">
                <span>‚Çπ5,000 - ‚Çπ10,000</span>
              </label>
              <label class="filter-option">
                <input type="radio" name="price" value="10000+" onchange="applyFilters()">
                <span>Above ‚Çπ10,000</span>
              </label>
            </div>
          </div>
          
          <button class="btn btn-outline btn-full" onclick="resetFilters()" style="margin-top: 16px;">
            Reset Filters
          </button>
        </aside>
        
        <!-- Product Grid -->
        <div class="shop-content">
          <div class="shop-header">
            <p class="shop-count"><span id="product-count">0</span> products</p>
            <select class="sort-select" id="sort-select" onchange="applyFilters()">
              <option value="created_at:desc">Newest First</option>
              <option value="price:asc">Price: Low to High</option>
              <option value="price:desc">Price: High to Low</option>
              <option value="name:asc">Name: A-Z</option>
            </select>
          </div>
          
          <div class="products-grid" id="products-grid">
            <!-- Products loaded dynamically -->
            <div class="product-card skeleton">
              <div class="product-image" style="background: #f0f0f0;"></div>
              <div class="product-info">
                <div style="height: 20px; background: #f0f0f0; margin-bottom: 8px;"></div>
                <div style="height: 16px; background: #f0f0f0; width: 60%;"></div>
              </div>
            </div>
            <div class="product-card skeleton">
              <div class="product-image" style="background: #f0f0f0;"></div>
              <div class="product-info">
                <div style="height: 20px; background: #f0f0f0; margin-bottom: 8px;"></div>
                <div style="height: 16px; background: #f0f0f0; width: 60%;"></div>
              </div>
            </div>
            <div class="product-card skeleton">
              <div class="product-image" style="background: #f0f0f0;"></div>
              <div class="product-info">
                <div style="height: 20px; background: #f0f0f0; margin-bottom: 8px;"></div>
                <div style="height: 16px; background: #f0f0f0; width: 60%;"></div>
              </div>
            </div>
          </div>
          
          <div id="no-products" style="display: none; text-align: center; padding: 60px 20px;">
            <div style="width: 80px; height: 80px; margin: 0 auto 24px; background: var(--color-bg-alt); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem;">üîç</div>
            <h3 style="margin-bottom: 8px;">No products found</h3>
            <p style="color: var(--color-text-secondary);">Try adjusting your filters</p>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <script>
    let currentFilters = {
      gender: '',
      minPrice: null,
      maxPrice: null,
      sort: 'created_at:desc',
      page: 1
    };
    
    // Parse URL params on load
    function parseUrlParams() {
      const params = new URLSearchParams(window.location.search);
      const gender = params.get('gender');
      if (gender) {
        document.querySelector(`input[name="gender"][value="${gender}"]`)?.click();
      }
    }
    
    async function applyFilters() {
      const genderEl = document.querySelector('input[name="gender"]:checked');
      const priceEl = document.querySelector('input[name="price"]:checked');
      const sortEl = document.getElementById('sort-select');
      
      currentFilters.gender = genderEl?.value || '';
      
      // Parse price range
      if (priceEl && priceEl.value) {
        const [min, max] = priceEl.value.split('-').map(v => v.replace('+', ''));
        currentFilters.minPrice = min || null;
        currentFilters.maxPrice = max || null;
      } else {
        currentFilters.minPrice = null;
        currentFilters.maxPrice = null;
      }
      
      currentFilters.sort = sortEl.value;
      
      await loadProducts();
    }
    
    function resetFilters() {
      document.querySelectorAll('input[type="radio"]').forEach(el => {
        el.checked = el.value === '';
      });
      document.getElementById('sort-select').value = 'created_at:desc';
      applyFilters();
    }
    
    async function loadProducts() {
      const grid = document.getElementById('products-grid');
      const noProducts = document.getElementById('no-products');
      
      // Show loading state
      grid.style.opacity = '0.5';
      
      try {
        const params = {};
        if (currentFilters.gender) params.gender = currentFilters.gender;
        if (currentFilters.minPrice) params.minPrice = currentFilters.minPrice;
        if (currentFilters.maxPrice) params.maxPrice = currentFilters.maxPrice;
        if (currentFilters.sort) params.sort = currentFilters.sort;
        
        const data = await Clefeel.api.products.getAll(params);
        const products = data.perfumes || [];
        
        document.getElementById('product-count').textContent = products.length;
        
        if (products.length === 0) {
          grid.style.display = 'none';
          noProducts.style.display = 'block';
        } else {
          grid.style.display = 'grid';
          noProducts.style.display = 'none';
          
          grid.innerHTML = products.map(product => `
            <div class="product-card">
              <div class="product-image">
                <img src="${product.images?.[0] || 'https://via.placeholder.com/400x500?text=No+Image'}" alt="${product.name}" loading="lazy">
                <div class="product-actions">
                  <a href="/product.html?slug=${product.slug}" class="btn btn-primary">View Details</a>
                </div>
              </div>
              <div class="product-info">
                <h3 class="product-name">${product.name}</h3>
                <p class="product-meta">${product.gender?.charAt(0).toUpperCase() + product.gender?.slice(1) || 'Unisex'} ‚Ä¢ ${product.variants?.filter(v => v && v.id).length || 0} sizes</p>
                <p class="product-price">
                  From ${Clefeel.utils.formatPrice(product.minPrice || product.variants?.[0]?.price || 0)}
                </p>
              </div>
            </div>
          `).join('');
        }
      } catch (error) {
        console.error('Failed to load products:', error);
        // Show demo products as fallback
        showDemoProducts();
      }
      
      grid.style.opacity = '1';
    }
    
    function showDemoProducts() {
      const grid = document.getElementById('products-grid');
      const demoProducts = [
        { name: "Midnight Oud", gender: "men", slug: "midnight-oud", images: ["https://res.cloudinary.com/dgojt5udn/image/upload/v1771416046/bottle-vert_mazgji.png"], variants: [{price: 4999}], minPrice: 4999 },
        { name: "Rose Petals", gender: "women", slug: "rose-petals", images: ["https://res.cloudinary.com/dgojt5udn/image/upload/v1771416046/bottle-rose_sajvoq.png"], variants: [{price: 3999}], minPrice: 3999 },
        { name: "Citrus Bloom", gender: "unisex", slug: "citrus-bloom", images: ["https://res.cloudinary.com/dgojt5udn/image/upload/v1771416045/bottle-soleil_mle6gz.png"], variants: [{price: 3499}], minPrice: 3499 },
        { name: "Velvet Musk", gender: "men", slug: "velvet-musk", images: ["https://res.cloudinary.com/dgojt5udn/image/upload/v1771416046/bottle-vert_mazgji.png"], variants: [{price: 5999}], minPrice: 5999 },
        { name: "Jasmine Dreams", gender: "women", slug: "jasmine-dreams", images: ["https://res.cloudinary.com/dgojt5udn/image/upload/v1771416046/bottle-rose_sajvoq.png"], variants: [{price: 4499}], minPrice: 4499 },
        { name: "Ocean Breeze", gender: "unisex", slug: "ocean-breeze", images: ["https://res.cloudinary.com/dgojt5udn/image/upload/v1771416045/bottle-soleil_mle6gz.png"], variants: [{price: 2999}], minPrice: 2999 }
      ];
      
      document.getElementById('product-count').textContent = demoProducts.length;
      
      grid.innerHTML = demoProducts.map(product => `
        <div class="product-card">
          <div class="product-image">
            <img src="${product.images[0]}" alt="${product.name}" loading="lazy">
            <div class="product-actions">
              <a href="/product.html?slug=${product.slug}" class="btn btn-primary">View Details</a>
            </div>
          </div>
          <div class="product-info">
            <h3 class="product-name">${product.name}</h3>
            <p class="product-meta">${product.gender.charAt(0).toUpperCase() + product.gender.slice(1)} ‚Ä¢ 3 sizes</p>
            <p class="product-price">
              From ${Clefeel.utils.formatPrice(product.minPrice)}
            </p>
          </div>
        </div>
      `).join('');
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      parseUrlParams();
      loadProducts();
    });
  </script>
</body>
</html>
